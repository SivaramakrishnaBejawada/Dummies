# Start from Ubuntu base image
FROM ubuntu:22.04

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive
ENV JENKINS_HOME=/var/jenkins_home

# Install dependencies (Java, wget, git, etc.)
RUN apt-get update && \
    apt-get install -y openjdk-11-jdk wget gnupg git && \
    rm -rf /var/lib/apt/lists/*

# Create Jenkins home directory
RUN mkdir -p $JENKINS_HOME && \
    chown -R root:root $JENKINS_HOME

# Download Jenkins war file and place in /usr/share/java
RUN mkdir -p /usr/share/java && \
    wget -O /usr/share/java/jenkins.war \
        https://get.jenkins.io/war-stable/latest/jenkins.war

# Expose Jenkins ports
EXPOSE 8080 50000

# Define volumes (for Jenkins data persistence and war override if needed)
VOLUME ["$JENKINS_HOME", "/usr/share/java/jenkins.war"]

# Default command to start Jenkins
CMD ["java", "-jar", "/usr/share/java/jenkins.war"]
